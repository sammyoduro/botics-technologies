<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Bootstrap-ecommerce by Vosidiy">

<title>Botics Administrators</title>

<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"> </script>
 <script src="https://code.jquery.com/jquery-3.1.1.min.js" ></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.js"></script>
<!-- Bootstrap4 files-->
<script src="/javascripts/bootstrap.bundle.min.js" type="text/javascript"></script>
<link href="/stylesheets/bootstrap.css?v=1.0" rel="stylesheet" type="text/css"/>

<!-- Font awesome 5 -->
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<!-- include summernote css/js -->
<link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.9/summernote.css" rel="stylesheet">
<!-- plugin: fancybox  -->
<script src="/plugins/fancybox/fancybox.min.js" type="text/javascript"></script>
<link href="/plugins/fancybox/fancybox.min.css" type="text/css" rel="stylesheet">

<!-- plugin: owl carousel  -->
<link href="/plugins/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
<link href="/plugins/owlcarousel/assets/owl.theme.default.css" rel="stylesheet">
<script src="/plugins/owlcarousel/owl.carousel.min.js"></script>

<!-- custom style -->
<link href="/stylesheets/ui.css?v=1.0" rel="stylesheet" type="text/css"/>
<link href="/stylesheets/responsive.css" rel="stylesheet" media="only screen and (max-width: 1200px)" />
<link href="/stylesheets/adminstyle.css" rel="stylesheet" type="text/css"/>

<!-- custom javascript -->
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="/javascripts/adminscript.js" type="text/javascript"></script>

</head>
<body>
<header class="section-header">
  <section class="header-main">
  	<div class="container">
  <div class="row align-items-center">
  	<div class="col-lg-3 col-sm-4">
  	<div class="brand-wrap">
  		<a href="/"><img class="logo" src="../../../../../images/one.png"></a>
  		<!-- <h2 class="logo-text">BOTICS TECHNOLOGIES</h2> -->
  	</div> <!-- brand-wrap.// -->
  	</div>
  	<div class="col-lg-5 col-xl-4 col-sm-12 offset-lg-4">
  		<div class="widgets-wrap float-right">
        <div class="widget-header">
  				<a href="/users/login" data-toggle="dropdown"  data-offset="20,10">
  					<div class="icontext newnotify">
  						<div class="icon-wrap"><i class="icon-sm round border fa fa-envelope-o"></i></div>
  						<div class="text-wrap"></div>
  					</div>
  				</a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="/areacode97/admin/outofbound/admin/messages">messages notification <span class="m small badge badge-danger">  </span></a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/areacode97/admin/outofbound/admin/proposals">proposals notification <span class="p small badge badge-danger"> </span></a>
  				</div> <!--  dropdown-menu .// -->
  			</div>

  			<a href="" class="widget-header mr-3">
  				<div class="icontext">
  					<div class="icon-wrap"><i class="icon-sm round border fa fa-shopping-cart"></i></div>
  					<div class="text-wrap">
  						<span class="small badge badge-danger">
              0
              </span>
  					</div>
  				</div>
  			</a>
  			<div class="widget-header">
  				<a href="/users/login" data-toggle="dropdown"  data-offset="20,10">
  					<div class="icontext">
  						<div class="icon-wrap"><i class="icon-sm round border fa fa-user"></i></div>
  						<div class="text-wrap">
  							<small>Welcome</small>
  							<div><%= user.firstname %> <i class="fa fa-caret-down"></i> </div>
  						</div>
  					</div>
  				</a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#">Settings</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/areacode97/admin/outofbound/admin/page/logout">Logout</a>
  				</div> <!--  dropdown-menu .// -->
  			</div>  <!-- widget-header .// -->

  		</div> <!-- widgets-wrap.// -->
  	</div> <!-- col.// -->
  </div> <!-- row.// -->
  	</div> <!-- container.// -->
  </section> <!-- header-main .// -->


<nav class="navbar navbar-expand-lg navbar-dark bg-secondary">
  <div class="container">

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_nav" aria-controls="main_nav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="main_nav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/" target="_blank"> LIVE</a>
        </li>
        <li class="nav-item  active"><a href="/areacode97/admin/outofbound/admin/proposals" class="nav-link">  PROPOSALS </a></li>
        <li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">  ADMINISTRATORS </a>
            <ul class="dropdown-menu ">
      				<li><a class="dropdown-item" href="/areacode97/admin/outofbound/admin/adminsregistration">Register new admin</a></li>

            </ul>
        </li>
        <li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">  ITEMS </a>
            <ul class="dropdown-menu ">
      				<li><a class="dropdown-item" href="/areacode97/admin/outofbound/admin/items">Items list</a></li>
            </ul>
        </li>
        <li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">  TUTORIALS </a>
            <ul class="dropdown-menu ">
      				<li><a class="dropdown-item" href="/areacode97/admin/outofbound/admin/tutorials/new">New tutorial</a></li>
            </ul>
        </li>
        <li class="nav-item"><a href="/areacode97/admin/outofbound/admin/featured_vid" class="nav-link">  FEATURED VIDEOS </a></li>
        <li class="nav-item"><a href="/areacode97/admin/outofbound/admin/frequently_searched" class="nav-link">  FREQUENTLY SEARCHED </a></li>
        <li class="nav-item"><a href="/areacode97/admin/outofbound/admin/orders" class="nav-link">  ORDERS </a></li>
      </ul>
    </div> <!-- collapse .// -->
  </div> <!-- container .// -->
</nav>
</header> <!-- section-header.// -->
<!-- Large modal -->
<div class="modal fade" id="propasal-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="proposal-body">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<section class="section-content bg padding-y-sm">
<div class="container">
<nav class="mb-3">
<ol class="breadcrumb">
    <li class="breadcrumb-item active" aria-current="/proposals">Proposals</li>
</ol>
</nav>

<div class="row">
<div class="col-xl-12 col-md-12 col-sm-12">
      <main class="card">
        <div class="card-body">
          <div class="row">
    <div class="col-lg-12">
        <div class="row">
          <div class="col-md-6">
            <span class="process viewed"> viewed </span> <span class="process progres"> progress </span>  <span class="process completed">completed</span>
          </div>
          <div class="col-md-6">
            <input type="text" placeholder="search proposal" class="col-md-5 col-xs-4  form-control float-right" id="searchproposal">
          </div>
        </div>
      <br>
    </div>

    <div class="col-lg-12" style="margin-bottom:10px">
      <div class="col-lg-12 card">
        <div class="col-md-12" style="margin-bottom:10px;padding-top:50px;padding-left:0px;">
                  <div class="scrollbar scrollbar-primary">
                    <div class="force-overflow printout">
                        <% if(typeof proposals != 'undefined'){ %>
                        <ul class="list-group list-group-flush">
                          <% proposals.forEach(function(proposal){ %>
                          <li class="list-group-item">
                            <% if(  proposal.docStatus== 'viewed'){ %>
                              <div class="float-left process viewed proposal-status"></div>
                          <%}else if( proposal.docStatus== 'inprogress' ){%>
                            <div class="float-left process progres proposal-status"></div>
                           <%} else if( proposal.docStatus== 'completed' ){ %>
                             <div class="float-left process completed proposal-status" id="<%= proposal.id %>"></div>
                             <%}%>

                            <%= proposal.userid %> <%= proposal.fullname %>
                            <span class="badge badge-success  float-right"  id="<%= proposal.id %>" data-toggle="tooltip" data-placement="top" title="project completed"><i class="fa fa-check"></i></span>
                            <span class="badge badge-info float-right" id="<%= proposal.id %>" style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="project in progress"><i class="fa fa-hourglass-start"></i></span>
                            <span class="badge badge-danger float-right proposal-view" id="<%= proposal.id %>"  style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="view proposal"><i class="fa fa-eye"></i></span>
                            <span class="badge badge-warning float-right proposal-del" id="<%= proposal.id %>_del+<%= proposal.userid %>" style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="delete proposal"><i class="fa fa-trash"></i></span>
                            <br><small class="text-muted">sent @<%= proposal.timestamp %> &nbsp; viewed <%= proposal.viewed_timestamp %> &nbsp; in progress <%= proposal.inprogress_timestamp %> &nbsp; completed <%= proposal.completed_timestamp %></small>
                          </li>
                          <%  }) %>
                        </ul>
                      <% } %>
                    </div>
                  </div>

                </div>
              </div>

    </div>
  </div>
        </div>
      </main>
    </div>
  </div>
</div>
</section>
<script type="text/javascript">
         $(document).ready(function () {


             $("body").on('click','.proposal-view',function () {
               $('#propasal-modal').modal();
             //signing off  (OOK thanks onk i love u. getaway. jhahaha)
               var proposals = <%-JSON.stringify(proposals)%>
               var print ='';
               var id = $(this).attr('id');
               proposals.forEach(function (data) {
                 if(data._id == id){
                 print+="<div class=\"card\">";
                 print+="<div class=\"card-header\">";
                 print+="<small>document id</small> "+data.userid+"<span class=\"text-muted float-right\">@"+data.timestamp+"</span>";
                 print+="</div>";
                 print+="<div class=\"card-body\">";
                 print+="<h5 class=\"card-title\"><small>Proposal topic: </small>"+data.proposal_topic+"</h5><br>Name: "+data.fullname+" <br> Contact: "+data.phone_num+"";
                 print+="<p class=\"card-text\"><small>description: </small> <br>"+data.description+"</p>";
                 print+="<a href=\"../../../../files/"+data.filePath+"\" class=\"btn btn-primary prodownload\" id=\""+data._id+"\"><i class=\"fa fa-download\"></i> Download "+data.filePath+"</a>";
                 print+="</div>";
                 print+="</div>";
                 }

               });
                 document.getElementById('proposal-body').innerHTML = print;
             });
         });

         // delete proposal
             $('body').on('click','.proposal-del',function () {
               var id_base = $(this).attr('id');
               var id = id_base.split('_')[0];
               var proposal = id_base.split('+')[1];

               var data ={id:id,proposal:proposal}

               swal({
                 title: "Are you sure?",
                 text: "Once deleted, you will not be able to recover this imaginary file!",
                 icon: "warning",
                 buttons: true,
                 dangerMode: true,
               })
               .then((willDelete) => {
                 if (willDelete) {
                   return fetch("/areacode97/admin/outofbound/admin/proposal/del/"+id +"&proposal="+proposal);
                 }
               })
               .then(results => {
               if (!results) return false;

               swal({
                   title: proposal+" file",
                   text: "deletd successfully",
                   icon: "success",
                   button: "OK",
                 }).then(pass => {
                   if (pass) {
                     location.reload(true);
                   }
                 })
             })

             });
  // SEARCHFIELD
  $('#searchproposal').on('keyup',function () {
  var searchitem = {searchitem: $(this).val()}

  $.ajax({
    type        : 'post',
    data        : searchitem,
    dataType    : 'json',
    url         : '/areacode97/admin/outofbound/admin/proposal/search/',
    success     : function(data){
      if (data.length == 0) {
        $('.printout').html("<h6>file not found</h6>");

      }else{
        var printout ='<ul class="list-group list-group-flush">';
        for (var i = 0; i < data.length; i++) {
            printout +='<li class="list-group-item">';
            if ( data[i].docStatus == 'viewed') {
              printout+= '<div class="float-left process viewed proposal-status"></div>';
            }
            else if (data[i].docStatus == 'inprogress') {
              printout+= '<div class="float-left process progres proposal-status"></div>';
            }
            else if (data[i].docStatus == 'completed') {
              printout+= '<div class="float-left process completed proposal-status"></div>';
            }
            printout+= data[i].userid+' '+ data[i].fullname;
            printout+='<span class="badge badge-success  float-right"  id="'+data[i]._id+'" data-toggle="tooltip" data-placement="top" title="project completed"><i class="fa fa-check"></i></span>';
            printout+='<span class="badge badge-info float-right" id="'+data[i]._id+'" style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="project in progress"><i class="fa fa-hourglass-start"></i></span>';
            printout +='<span class="badge badge-danger float-right proposal-view" id="'+data[i]._id+'"  style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="view proposal">';
            printout +='<i class="fa fa-eye"></i></span>';
            printout +='<span class="badge badge-warning float-right proposal-del" id="'+data[i]._id;
            printout +='_del'+ data[i].userid+'" style="margin-right:10px" data-toggle="tooltip" data-placement="top" title="delete proposal"><i class="fa fa-trash"></i></span>';
            printout +='<br><small class="text-muted">sent @'+data[i].timestamp+' &nbsp; viewed '+data[i].viewed_timestamp+' &nbsp; in progress '+data[i].inprogress_timestamp+' &nbsp;completed '+data[i].completed_timestamp+'</small> </li>';
        }
        printout+='</ul>';
        $('.printout').html(printout);
      }
    }
  });

});
$('body').on('click','.prodownload',function () {
  var id = $(this).attr('id');
  var data = {state:'viewed',id:id}
  $.ajax({
    type        : 'post',
    data        : data,
    dataType    : 'json',
    url         : '/areacode97/admin/outofbound/admin/viewed/'+id,
    success     : function(data){
      if(data.status==true){
        $(".printout").load(location.href+" .printout>*","");
      }
    }
  });

});
$('body').on('click','.badge-info',function () {
  var id = $(this).attr('id');
  var data = {state:'progres',id:id}
  $.ajax({
    type        : 'post',
    data        : data,
    dataType    : 'json',
    url         : '/areacode97/admin/outofbound/admin/viewed/'+id,
    success     : function(data){
      if(data.status==true){
        $(".printout").load(location.href+" .printout>*","");
      }
    }
  });

})
$('body').on('click','.badge-success',function () {
  var id = $(this).attr('id');
  var data = {state:'completed',id:id}
  $.ajax({
    type        : 'post',
    data        : data,
    dataType    : 'json',
    url         : '/areacode97/admin/outofbound/admin/viewed/'+id,
    success     : function(data){
      if(data.status==true){
        $(".printout").load(location.href+" .printout>*","");
      }
    }
  });
});


     </script>
